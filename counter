#!/bin/bash

# ----
# script-o-counter - a script to count through 1.0 and 2.x SuiteScript code and compare their relative percentage 
# Author: Seymour Pashayev
# SeymourP@solution-source.net
# github: gordonsamh@gmail.com
# ----


# Function to check for 2.x code indicators:
# Use regexp to match 2.x code indicators: [ ____, define?, 'N/_____'] <-- TODO: Clarify what indicators to use.
# 
# Arguments: file - file to be parsed for code indicators 
# Return 0 if 2.x code indicators are found, 1 otherwise.
# TODO:  
function checkFor2XIndicators() {
    # Do not go deep here. Only parse the first couple of necessary lines to see if it is 2.x code
    # If you miss any 2.x code here, it will be found during the deep parse phase.
    # We are trying to minimize the number of files that we parse here by finding 2.x files right away.
}

# Function to check for 1.0 code indicators:
# Use regexp to match 1.0 code indicators: [ ____ ] <-- TODO: Clarify what indicators to use.
# 
# Arguments: line - line to be parsed for code indicators 
# Return 0 if 1.0 code indicators are found, 1 otherwise.
# TODO:  
function checkFor1XIndicators() {
    # Use regular expressions to match 1.0 indicators within the line
}

# Initialize counters for 1.0 and 2.X lines of code
total_lines_1X=0
total_lines_2X=0

# Instantiate arrays to store files of type 1.0 code and 2.x code
files_1X=()
files_2X=()

# Iterate through each file
for file in *.js; do
   
    # Check for 2.x indicators in the beginning
    if checkFor2XIndicators "$file"; then
        
	# Flag as 2.x and skip deep parsing
        echo "$file is 2.x"
	files_2X+=($file)	

	# Increment 2.x lines counter
        ((total_lines_2X += $(wc -l < "$file")))	
   
    else
        
	# Deep parsing for line count
        line_count=0
       
	while IFS= read -r line; do
            ((line_count++))
	    # TODO: use a checkFor1XIndicators() function?
	    
            # If 2.x indicators are found, flag and break
        done < "$file"
        
	echo "$file is 1.0 with $line_count lines"
	files_1X+=($file)	
	
	# Increment 1.0 lines counter
        ((total_lines_1X += line_count))
   
    fi
done

